<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Estoque</title>
    <style>
        /* Estilo da tabela */
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        /* Estilo para itens vencidos */
        .vencido {
            border: 2px solid red;
            background-color: #fdd;
        }
        /* Estilo para itens prestes a vencer */
        .prestes-vencer {
            border: 2px solid orange;
            background-color: #ffebcd;
        }
        /* Estilo do botão de filtro */
        .filtro-vencido {
            margin: 10px 0;
        }
    </style>
</head>
<body>

    <h1>Controle de Estoque</h1>

    <!-- Filtro de itens vencidos -->
    <button id="filtroVencido" class="filtro-vencido">Mostrar Apenas Vencidos</button>

    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Item</th>
                <th>Descrição</th>
                <th>Categoria</th>
                <th>Quantidade</th>
                <th>Unidade</th>
                <th>Valor</th>
                <th>Lote</th>
                <th>Ação</th>
            </tr>
        </thead>
        <tbody id="estoqueLista"></tbody>
    </table>

    <script>
        let filtroVencidoAtivo = false;

        // Função para carregar os itens do estoque
        function carregarEstoque() {
            const estoque = JSON.parse(localStorage.getItem('estoque')) || [];
            const tabelaBody = document.getElementById('estoqueLista');
            tabelaBody.innerHTML = '';

            estoque.forEach((item) => {
                const dataAtual = new Date();
                
                // Extraímos a data de vencimento a partir do lote (no formato ddmmaaaa)
                const lote = item.lote;
                const dia = parseInt(lote.substring(0, 2), 10);
                const mes = parseInt(lote.substring(2, 4), 10) - 1; // Meses começam de 0 no JavaScript
                const ano = parseInt(lote.substring(4, 8), 10);
                const dataVencimento = new Date(ano, mes, dia);
                
                const diferencaDias = Math.ceil((dataVencimento - dataAtual) / (1000 * 60 * 60 * 24));

                let vencidoClass = '';
                // Verificar se o item está vencido ou prestes a vencer
                if (diferencaDias < 0) {
                    vencidoClass = 'vencido';
                } else if (diferencaDias <= 4) {
                    vencidoClass = 'prestes-vencer';
                }

                // Não exibir o item se o filtro de vencido estiver ativo e o item não estiver vencido
                if (filtroVencidoAtivo && vencidoClass !== 'vencido') {
                    return;
                }

                // Criação da linha da tabela
                const tr = document.createElement('tr');
                tr.classList.add(vencidoClass);

                tr.innerHTML = `
                    <td>${item.id}</td>
                    <td>${item.item}</td>
                    <td>${item.descricao}</td>
                    <td>${item.categoria}</td>
                    <td>${item.quantidade}</td>
                    <td>${item.unidade}</td>
                    <td>${item.valor}</td>
                    <td>${item.lote}</td>
                    <td><img src="Imagens/Excluir.png" alt="Excluir" class="delete-icon" onclick="deletarItem(${item.id})"></td>
                `;
                
                tabelaBody.appendChild(tr);
            });
        }

        // Função para ativar/desativar o filtro de vencidos
        document.getElementById('filtroVencido').addEventListener('click', () => {
            filtroVencidoAtivo = !filtroVencidoAtivo;
            if (filtroVencidoAtivo) {
                document.getElementById('filtroVencido').innerText = 'Mostrar Todos';
            } else {
                document.getElementById('filtroVencido').innerText = 'Mostrar Apenas Vencidos';
            }
            carregarEstoque(); // Recarregar a lista após o filtro ser alterado
        });

        // Função para deletar item (exemplo simples)
        function deletarItem(id) {
            const estoque = JSON.parse(localStorage.getItem('estoque')) || [];
            const novoEstoque = estoque.filter(item => item.id !== id);
            localStorage.setItem('estoque', JSON.stringify(novoEstoque));
            carregarEstoque(); // Atualiza a tabela após a exclusão
        }

        // Carregar o estoque ao iniciar
        carregarEstoque();
    </script>

</body>
</html>

