<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estoque</title>
    <style>
        /* Adicionar estilos conforme necessário */
        .vencido {
            background-color: #f8d7da;
        }

        .prestes-vencer {
            background-color: #fff3cd;
        }

        .zero-saldo {
            color: red;
        }

        .baixo-saldo {
            color: orange;
        }

        .delete-icon {
            width: 20px;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <h1>Controle de Estoque</h1>

    <div>
        <button onclick="toggleFiltroZero()">Filtro Saldo Zero</button>
        <button onclick="toggleFiltroVencido()">Filtro Vencidos</button>
        <input type="text" id="filtro" placeholder="Filtrar por nome ou descrição" oninput="filtrarItens()">
    </div>

    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Item</th>
                <th>Descrição</th>
                <th>Categoria</th>
                <th>Quantidade</th>
                <th>Unidade</th>
                <th>Valor</th>
                <th>Lote</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody id="estoqueLista">
            <!-- Itens serão carregados aqui -->
        </tbody>
    </table>

    <script>
        let filtroZeroAtivo = false;
        let filtroVencidoAtivo = false;

        function carregarEstoque() {
            const estoque = JSON.parse(localStorage.getItem('estoque')) || [];
            const tabelaBody = document.getElementById('estoqueLista');
            tabelaBody.innerHTML = '';

            estoque.forEach((item) => {
                // Lote no formato ddmmaaaa, então podemos diretamente comparar as strings
                const lote = item.lote;
                const dataAtual = new Date();
                const dataLote = new Date(lote.substring(4, 8), lote.substring(2, 4) - 1, lote.substring(0, 2));

                let saldoClass = '';
                if (item.quantidade == 0 && !filtroZeroAtivo) return;
                if (item.quantidade == 0) saldoClass = 'zero-saldo';
                else if (item.quantidade < 5) saldoClass = 'baixo-saldo';

                let vencidoClass = '';
                if (filtroVencidoAtivo && dataLote < dataAtual) {
                    vencidoClass = 'vencido';
                }

                // Se a data de vencimento estiver dentro dos próximos 4 dias, marcar como 'prestes a vencer'
                const diferencaDias = Math.ceil((dataLote - dataAtual) / (1000 * 60 * 60 * 24));
                if (diferencaDias <= 4 && diferencaDias >= 0) {
                    vencidoClass = 'prestes-vencer';
                }

                // Criar a linha da tabela
                const linha = document.createElement('tr');
                linha.classList.add(vencidoClass, saldoClass);

                // Adicionar os dados à linha
                linha.innerHTML = `
                    <td>${item.id}</td>
                    <td>${item.item}</td>
                    <td>${item.descricao}</td>
                    <td>${item.categoria}</td>
                    <td>${item.quantidade}</td>
                    <td>${item.unidade}</td>
                    <td>${item.valor}</td>
                    <td>${item.lote}</td>
                    <td><img src="Imagens/delete.png" alt="Excluir" class="delete-icon" onclick="deletarItem(${item.id})"></td>
                `;

                // Adicionar a linha na tabela
                tabelaBody.appendChild(linha);
            });
        }

        // Função para deletar um item
        function deletarItem(id) {
            const estoque = JSON.parse(localStorage.getItem('estoque')) || [];
            const novoEstoque = estoque.filter(item => item.id !== id);
            localStorage.setItem('estoque', JSON.stringify(novoEstoque));
            carregarEstoque(); // Atualizar a tabela após a exclusão
        }

        // Filtro para itens com saldo zero
        function toggleFiltroZero() {
            filtroZeroAtivo = !filtroZeroAtivo;
            carregarEstoque();
        }

        // Filtro para itens vencidos
        function toggleFiltroVencido() {
            filtroVencidoAtivo = !filtroVencidoAtivo;
            carregarEstoque();
        }

        // Filtragem de itens pelo nome
        function filtrarItens() {
            const filtro = document.getElementById('filtro').value.toLowerCase();
            const estoque = JSON.parse(localStorage.getItem('estoque')) || [];
            const tabelaBody = document.getElementById('estoqueLista');
            tabelaBody.innerHTML = '';

            estoque.forEach((item) => {
                if (item.item.toLowerCase().includes(filtro) || item.descricao.toLowerCase().includes(filtro)) {
                    // Lote no formato ddmmaaaa
                    const lote = item.lote;
                    const dataAtual = new Date();
                    const dataLote = new Date(lote.substring(4, 8), lote.substring(2, 4) - 1, lote.substring(0, 2));

                    let vencidoClass = '';
                    if (dataLote < dataAtual) {
                        vencidoClass = 'vencido';
                    } else {
                        const diferencaDias = Math.ceil((dataLote - dataAtual) / (1000 * 60 * 60 * 24));
                        if (diferencaDias <= 4 && diferencaDias >= 0) {
                            vencidoClass = 'prestes-vencer';
                        }
                    }

                    // Criar a linha da tabela
                    const linha = document.createElement('tr');
                    linha.classList.add(vencidoClass);

                    // Adicionar os dados à linha
                    linha.innerHTML = `
                        <td>${item.id}</td>
                        <td>${item.item}</td>
                        <td>${item.descricao}</td>
                        <td>${item.categoria}</td>
                        <td>${item.quantidade}</td>
                        <td>${item.unidade}</td>
                        <td>${item.valor}</td>
                        <td>${item.lote}</td>
                        <td><img src="Imagens/delete.png" alt="Excluir" class="delete-icon" onclick="deletarItem(${item.id})"></td>
                    `;

                    // Adicionar a linha na tabela
                    tabelaBody.appendChild(linha);
                }
            });
        }

        // Carregar o estoque ao iniciar
        carregarEstoque();
    </script>
</body>

</html>

